<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitrage Filter - Dashboard Style Match</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #FAFAFA;
            padding: 40px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            font-size: 14px;
            color: #171717;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Container */
        .demo-container {
            width: 100%;
            max-width: 480px;
        }

        /* Filter Button - Matching ModernButton secondary style */
        .filter-trigger {
            position: relative;
            display: inline-block;
        }

        .filter-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            background: #F5F5F5;
            border: none;
            border-radius: 6px;
            color: #171717;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .filter-btn:hover {
            background: #E5E5E5;
        }

        .filter-btn:active {
            background: #D4D4D4;
        }

        .filter-btn.active {
            background: #0066FF;
            color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }

        .filter-btn.active:hover {
            background: #0052CC;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .filter-icon {
            width: 16px;
            height: 16px;
        }

        .filter-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 18px;
            padding: 0 6px;
            background: #0066FF;
            color: white;
            border-radius: 9px;
            font-size: 11px;
            font-weight: 600;
        }

        .filter-btn.active .filter-count {
            background: rgba(255, 255, 255, 0.9);
            color: #0066FF;
        }

        /* Dropdown Panel - Matching ModernCard style */
        .filter-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            width: 440px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            z-index: 50;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.2s, transform 0.2s;
        }

        .filter-dropdown.hidden {
            display: none;
            opacity: 0;
            transform: translateY(-10px);
        }

        /* Header */
        .filter-header {
            padding: 16px 20px;
            background: #FAFAFA;
            border-bottom: 1px solid #E5E5E5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-title {
            color: #171717;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .filter-actions {
            display: flex;
            gap: 8px;
        }

        .filter-action-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            color: #525252;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .filter-action-btn:hover {
            background: #F5F5F5;
            border-color: #D4D4D4;
        }

        .filter-action-btn.apply {
            background: #0066FF;
            color: white;
            border-color: #0066FF;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .filter-action-btn.apply:hover {
            background: #0052CC;
            border-color: #0052CC;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }

        /* Content */
        .filter-content {
            padding: 20px;
            background: white;
            max-height: 460px;
            overflow-y: auto;
        }

        /* Scrollbar */
        .filter-content::-webkit-scrollbar {
            width: 8px;
        }

        .filter-content::-webkit-scrollbar-track {
            background: #FAFAFA;
        }

        .filter-content::-webkit-scrollbar-thumb {
            background: #D4D4D4;
            border-radius: 4px;
        }

        .filter-content::-webkit-scrollbar-thumb:hover {
            background: #A3A3A3;
        }

        /* Sections */
        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .section-label {
            color: #737373;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        /* Input Group */
        .input-group {
            margin-bottom: 12px;
        }

        .input-label {
            color: #525252;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            display: block;
        }

        .input-field {
            width: 100%;
            padding: 8px 12px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            color: #171717;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .input-field:hover {
            border-color: #D4D4D4;
        }

        .input-field:focus {
            outline: none;
            border-color: #0066FF;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .input-field::placeholder {
            color: #A3A3A3;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Asset Autocomplete Wrapper */
        .asset-autocomplete-wrapper {
            position: relative;
        }

        .asset-tag-input {
            width: 100%;
            min-height: 38px;
            padding: 4px 8px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            cursor: text;
            transition: all 0.2s;
        }

        .asset-tag-input:hover {
            border-color: #D4D4D4;
        }

        .asset-tag-input:focus-within {
            border-color: #0066FF;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .asset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .asset-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: #EFF6FF;
            border: 1px solid #3B82F6;
            border-radius: 12px;
            color: #0066FF;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.15s;
        }

        .asset-tag:hover {
            background: #DBEAFE;
        }

        .asset-tag .tag-remove {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: #3B82F6;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            line-height: 1;
            cursor: pointer;
            transition: all 0.15s;
        }

        .asset-tag .tag-remove:hover {
            background: #0066FF;
        }

        .asset-search-input {
            flex: 1;
            min-width: 120px;
            border: none;
            outline: none;
            padding: 4px;
            background: transparent;
            color: #171717;
            font-size: 14px;
            font-family: inherit;
        }

        .asset-search-input::placeholder {
            color: #A3A3A3;
        }

        /* Autocomplete Dropdown */
        .autocomplete-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            max-height: 320px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .autocomplete-dropdown.visible {
            display: block;
        }

        .autocomplete-dropdown::-webkit-scrollbar {
            width: 8px;
        }

        .autocomplete-dropdown::-webkit-scrollbar-track {
            background: #FAFAFA;
        }

        .autocomplete-dropdown::-webkit-scrollbar-thumb {
            background: #D4D4D4;
            border-radius: 4px;
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.15s;
            border-bottom: 1px solid #F5F5F5;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.highlighted {
            background: #F5F5F5;
        }

        .autocomplete-item.selected {
            background: #EFF6FF;
        }

        .autocomplete-symbol {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .autocomplete-symbol-text {
            font-size: 14px;
            font-weight: 600;
            color: #171717;
        }

        .autocomplete-symbol-name {
            font-size: 12px;
            color: #737373;
            font-weight: 400;
        }

        .autocomplete-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
        }

        .autocomplete-meta-item {
            color: #525252;
        }

        .autocomplete-meta-item.positive {
            color: #059669;
        }

        .autocomplete-meta-item.negative {
            color: #DC2626;
        }

        .autocomplete-no-results {
            padding: 20px;
            text-align: center;
            color: #A3A3A3;
            font-size: 13px;
        }

        .match-highlight {
            background: #FEF08A;
            font-weight: 600;
        }

        /* Select */
        .select-field {
            width: 100%;
            padding: 8px 36px 8px 12px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            color: #171717;
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 20px;
            transition: all 0.2s;
        }

        .select-field:hover {
            border-color: #D4D4D4;
        }

        .select-field:focus {
            outline: none;
            border-color: #0066FF;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        /* Exchange Grid */
        .exchange-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .exchange-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 13px;
        }

        .exchange-item:hover {
            background: #FAFAFA;
            border-color: #D4D4D4;
        }

        .exchange-item.selected {
            background: #EFF6FF;
            border-color: #3B82F6;
        }

        .exchange-checkbox {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #0066FF;
        }

        .exchange-label {
            color: #171717;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
        }

        /* Interval Pills */
        .interval-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .interval-pill {
            padding: 6px 14px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 16px;
            color: #525252;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }

        .interval-pill:hover {
            background: #FAFAFA;
            border-color: #D4D4D4;
            color: #171717;
        }

        .interval-pill.selected {
            background: #0066FF;
            border-color: #0066FF;
            color: white;
        }

        .interval-pill.selected:hover {
            background: #0052CC;
            border-color: #0052CC;
        }

        /* Active Filters Footer */
        .active-filters {
            padding: 12px 20px;
            background: #FAFAFA;
            border-top: 1px solid #E5E5E5;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 44px;
            align-items: center;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: white;
            border: 1px solid #D4D4D4;
            border-radius: 12px;
            color: #525252;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.15s;
        }

        .filter-tag:hover {
            background: #F5F5F5;
            border-color: #A3A3A3;
        }

        .filter-tag .remove {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: #737373;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            line-height: 1;
            cursor: pointer;
        }

        .filter-tag .remove:hover {
            background: #525252;
        }

        .no-filters {
            color: #A3A3A3;
            font-size: 12px;
            font-style: italic;
        }

        /* Demo info */
        .style-info {
            margin-top: 24px;
            padding: 16px;
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
        }

        .style-info h3 {
            color: #171717;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .style-info ul {
            list-style: none;
            padding: 0;
        }

        .style-info li {
            color: #525252;
            font-size: 13px;
            line-height: 1.8;
            padding-left: 16px;
            position: relative;
        }

        .style-info li:before {
            content: "•";
            color: #0066FF;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Filter Trigger -->
        <div class="filter-trigger">
            <button class="filter-btn" id="filterBtn">
                <svg class="filter-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M1 3.5A.5.5 0 0 1 1.5 3h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 3.5zM4 7.5A.5.5 0 0 1 4.5 7h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 7.5zM6.5 11a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3z"/>
                </svg>
                Filters
                <span class="filter-count" id="filterCount" style="display: none;">0</span>
            </button>

            <!-- Filter Dropdown -->
            <div class="filter-dropdown hidden" id="filterDropdown">
                <div class="filter-header">
                    <span class="filter-title">Filter Options</span>
                    <div class="filter-actions">
                        <button class="filter-action-btn" id="clearBtn">Clear</button>
                        <button class="filter-action-btn apply" id="applyBtn">Apply</button>
                    </div>
                </div>

                <div class="filter-content">
                    <!-- Basic Filters -->
                    <div class="filter-section">
                        <div class="section-label">Basic Filters</div>
                        <div class="input-group">
                            <label class="input-label">Asset</label>
                            <div class="asset-autocomplete-wrapper">
                                <div class="asset-tag-input" id="assetTagInput">
                                    <div class="asset-tags" id="assetTags"></div>
                                    <input type="text" class="asset-search-input" id="assetSearchInput" placeholder="Search assets (e.g., BTC, ETH, SOL)">
                                </div>
                                <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Exchanges -->
                    <div class="filter-section">
                        <div class="section-label">Exchanges</div>
                        <div class="exchange-grid">
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="binance" checked>
                                <label class="exchange-label" for="binance">Binance</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="kucoin" checked>
                                <label class="exchange-label" for="kucoin">KuCoin</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="bybit" checked>
                                <label class="exchange-label" for="bybit">ByBit</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="hyperliquid" checked>
                                <label class="exchange-label" for="hyperliquid">Hyperliquid</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="aster" checked>
                                <label class="exchange-label" for="aster">Aster</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="lighter" checked>
                                <label class="exchange-label" for="lighter">Lighter</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="backpack" checked>
                                <label class="exchange-label" for="backpack">Backpack</label>
                            </div>
                            <div class="exchange-item selected">
                                <input type="checkbox" class="exchange-checkbox" id="drift" checked>
                                <label class="exchange-label" for="drift">Drift</label>
                            </div>
                        </div>
                    </div>

                    <!-- Funding Intervals -->
                    <div class="filter-section">
                        <div class="section-label">Funding Intervals</div>
                        <div class="interval-pills">
                            <div class="interval-pill selected">1 hour</div>
                            <div class="interval-pill selected">2 hours</div>
                            <div class="interval-pill selected">4 hours</div>
                            <div class="interval-pill selected">8 hours</div>
                        </div>
                    </div>

                    <!-- APR Filter -->
                    <div class="filter-section">
                        <div class="section-label">APR Spread</div>
                        <div class="input-row">
                            <div class="input-group">
                                <label class="input-label">Min APR Spread</label>
                                <select class="select-field" aria-label="Min APR" id="minApr">
                                    <option>No minimum</option>
                                    <option>5%</option>
                                    <option>10%</option>
                                    <option>20%</option>
                                    <option>30%</option>
                                    <option>50%</option>
                                    <option>75%</option>
                                    <option>100%</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Max APR Spread</label>
                                <select class="select-field" aria-label="Max APR" id="maxApr">
                                    <option>50%</option>
                                    <option>100%</option>
                                    <option>200%</option>
                                    <option>500%</option>
                                    <option>1000%</option>
                                    <option selected>No limit</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Liquidity -->
                    <div class="filter-section">
                        <div class="section-label">Liquidity Requirements</div>
                        <div class="input-row">
                            <div class="input-group">
                                <label class="input-label">Min OI (Either)</label>
                                <select class="select-field" id="minOiEither">
                                    <option>No minimum</option>
                                    <option>$10K</option>
                                    <option>$100K</option>
                                    <option>$1M</option>
                                    <option>$10M</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label class="input-label">Min Combined OI</label>
                                <select class="select-field" id="minOiCombined">
                                    <option>No minimum</option>
                                    <option>$100K</option>
                                    <option>$500K</option>
                                    <option>$1M</option>
                                    <option>$10M</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Filters -->
                <div class="active-filters" id="activeFilters">
                </div>
            </div>
        </div>

        <div class="style-info">
            <h3>Dashboard Style Applied:</h3>
            <ul>
                <li>Clean white backgrounds with subtle gray accents</li>
                <li>Primary blue (#0066FF) for actions and selections</li>
                <li>Grays from #FAFAFA to #171717 matching Tailwind scale</li>
                <li>Inter font family with proper weight hierarchy</li>
                <li>Minimal shadows and borders (#E5E5E5)</li>
                <li>Consistent with ModernCard and ModernButton components</li>
                <li>NEW: Multi-asset autocomplete with fuzzy search and tag-based selection</li>
            </ul>
        </div>
    </div>

    <script>
        // Sample asset data for autocomplete (simulates API response)
        const SAMPLE_ASSETS = [
            { symbol: 'BTC', exchanges: 8, rate: 0.0095, apr: 10.45, name: 'Bitcoin' },
            { symbol: 'ETH', exchanges: 8, rate: 0.0082, apr: 9.02, name: 'Ethereum' },
            { symbol: 'SOL', exchanges: 6, rate: 0.0156, apr: 17.16, name: 'Solana' },
            { symbol: 'DOGE', exchanges: 7, rate: -0.0023, apr: -2.53, name: 'Dogecoin' },
            { symbol: 'AVAX', exchanges: 6, rate: 0.0091, apr: 10.01, name: 'Avalanche' },
            { symbol: 'MATIC', exchanges: 5, rate: 0.0067, apr: 7.37, name: 'Polygon' },
            { symbol: 'LINK', exchanges: 6, rate: 0.0104, apr: 11.44, name: 'Chainlink' },
            { symbol: 'UNI', exchanges: 5, rate: 0.0078, apr: 8.58, name: 'Uniswap' },
            { symbol: 'PEPE', exchanges: 7, rate: 0.0234, apr: 25.74, name: 'Pepe' },
            { symbol: 'SHIB', exchanges: 6, rate: 0.0145, apr: 15.95, name: 'Shiba Inu' },
            { symbol: 'ARB', exchanges: 5, rate: 0.0088, apr: 9.68, name: 'Arbitrum' },
            { symbol: 'OP', exchanges: 4, rate: 0.0072, apr: 7.92, name: 'Optimism' },
            { symbol: 'AAVE', exchanges: 5, rate: 0.0096, apr: 10.56, name: 'Aave' },
            { symbol: 'MKR', exchanges: 3, rate: 0.0084, apr: 9.24, name: 'Maker' },
            { symbol: 'LDO', exchanges: 4, rate: 0.0112, apr: 12.32, name: 'Lido DAO' },
            { symbol: 'ATOM', exchanges: 6, rate: 0.0069, apr: 7.59, name: 'Cosmos' },
            { symbol: 'DOT', exchanges: 5, rate: 0.0075, apr: 8.25, name: 'Polkadot' },
            { symbol: 'TRX', exchanges: 6, rate: 0.0043, apr: 4.73, name: 'Tron' },
            { symbol: 'ADA', exchanges: 6, rate: 0.0058, apr: 6.38, name: 'Cardano' },
            { symbol: 'XRP', exchanges: 7, rate: 0.0062, apr: 6.82, name: 'Ripple' },
            { symbol: 'ORDI', exchanges: 4, rate: 0.0187, apr: 20.57, name: 'Ordinals' },
            { symbol: 'WLD', exchanges: 4, rate: 0.0215, apr: 23.65, name: 'Worldcoin' },
            { symbol: 'BABYDOGE', exchanges: 3, rate: 0.0298, apr: 32.78, name: 'Baby Doge' },
            { symbol: 'FLOKI', exchanges: 5, rate: 0.0176, apr: 19.36, name: 'Floki Inu' },
            { symbol: 'BONK', exchanges: 4, rate: 0.0245, apr: 26.95, name: 'Bonk' },
            { symbol: 'WIF', exchanges: 3, rate: 0.0289, apr: 31.79, name: 'Dogwifhat' },
            { symbol: 'BTCDOM', exchanges: 2, rate: 0.0034, apr: 3.74, name: 'BTC Dominance' },
            { symbol: 'ETHFI', exchanges: 4, rate: 0.0198, apr: 21.78, name: 'Ether.fi' },
            { symbol: 'PENDLE', exchanges: 4, rate: 0.0167, apr: 18.37, name: 'Pendle' },
            { symbol: 'STRK', exchanges: 3, rate: 0.0223, apr: 24.53, name: 'Starknet' }
        ];

        // Selected assets (stores tag data)
        let selectedAssets = [];
        let highlightedIndex = -1;

        // DOM Elements
        const filterBtn = document.getElementById('filterBtn');
        const filterDropdown = document.getElementById('filterDropdown');
        const filterCount = document.getElementById('filterCount');
        const clearBtn = document.getElementById('clearBtn');
        const applyBtn = document.getElementById('applyBtn');

        // Filter dropdown toggle
        function toggleFilterDropdown() {
            const isHidden = filterDropdown.classList.contains('hidden');
            if (isHidden) {
                filterDropdown.classList.remove('hidden');
                filterBtn.classList.add('active');
            } else {
                filterDropdown.classList.add('hidden');
                filterBtn.classList.remove('active');
            }
        }

        function closeFilterDropdown() {
            filterDropdown.classList.add('hidden');
            filterBtn.classList.remove('active');
        }

        // Dynamic filter count
        function updateFilterCount() {
            let count = 0;

            count += selectedAssets.length;

            const selectedExchanges = document.querySelectorAll('.exchange-item input[type="checkbox"]:checked');
            if (selectedExchanges.length > 0 && selectedExchanges.length < 8) {
                count += 1;
            }

            const selectedIntervals = document.querySelectorAll('.interval-pill.selected');
            if (selectedIntervals.length > 0 && selectedIntervals.length < 4) {
                count += 1;
            }

            const minAprSelect = document.querySelector('select[aria-label="Min APR"]');
            const maxAprSelect = document.querySelector('select[aria-label="Max APR"]');
            if ((minAprSelect && minAprSelect.selectedIndex > 0) ||
                (maxAprSelect && maxAprSelect.selectedIndex > 0 && maxAprSelect.selectedIndex < maxAprSelect.options.length - 1)) {
                count += 1;
            }

            const minOiEither = document.getElementById('minOiEither');
            const minOiCombined = document.getElementById('minOiCombined');
            if ((minOiEither && minOiEither.selectedIndex > 0) || (minOiCombined && minOiCombined.selectedIndex > 0)) {
                count += 1;
            }

            if (count > 0) {
                filterCount.textContent = count;
                filterCount.style.display = 'inline-flex';
            } else {
                filterCount.style.display = 'none';
            }

            if (count > 0) {
                filterBtn.classList.add('active');
            } else if (filterDropdown.classList.contains('hidden')) {
                filterBtn.classList.remove('active');
            }
        }

        // Clear all filters
        function clearAllFilters() {
            selectedAssets = [];
            renderAssetTags();

            document.querySelectorAll('.exchange-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
                checkbox.closest('.exchange-item').classList.add('selected');
            });

            document.querySelectorAll('.interval-pill').forEach(pill => {
                pill.classList.add('selected');
            });

            document.querySelectorAll('select').forEach(select => {
                if (select.id === 'maxApr') {
                    select.selectedIndex = select.options.length - 1;
                } else {
                    select.selectedIndex = 0;
                }
            });

            document.querySelector('#assetSearchInput').value = '';

            updateFilterCount();
            updateActiveFilters();
            hideAutocomplete();
        }

        // Filter button click
        filterBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleFilterDropdown();
        });

        // Clear button click
        clearBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearAllFilters();
        });

        // Apply button click
        applyBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeFilterDropdown();
        });

        // Click outside to close
        document.addEventListener('click', (e) => {
            const filterTrigger = document.querySelector('.filter-trigger');
            if (!filterTrigger.contains(e.target)) {
                closeFilterDropdown();
            }
        });

        // Fuzzy search algorithm
        function fuzzySearch(query, text) {
            query = query.toLowerCase();
            text = text.toLowerCase();

            let queryIndex = 0;
            let textIndex = 0;
            let score = 0;
            let lastMatchIndex = -1;
            const matches = [];

            while (queryIndex < query.length && textIndex < text.length) {
                if (query[queryIndex] === text[textIndex]) {
                    matches.push(textIndex);
                    const gap = textIndex - lastMatchIndex - 1;
                    score += Math.max(0, 10 - gap);
                    if (textIndex === queryIndex) score += 5;
                    lastMatchIndex = textIndex;
                    queryIndex++;
                }
                textIndex++;
            }

            if (queryIndex !== query.length) {
                return null;
            }

            return { score, matches };
        }

        function searchAssets(query) {
            const results = [];

            SAMPLE_ASSETS.forEach(asset => {
                if (selectedAssets.some(s => s.symbol === asset.symbol)) {
                    return;
                }

                if (!query || query.trim() === '') {
                    results.push({
                        asset,
                        score: 0,
                        matches: []
                    });
                    return;
                }

                const symbolMatch = fuzzySearch(query, asset.symbol);
                const nameMatch = fuzzySearch(query, asset.name);

                let bestMatch = null;
                if (symbolMatch && nameMatch) {
                    bestMatch = symbolMatch.score > nameMatch.score ? symbolMatch : nameMatch;
                } else {
                    bestMatch = symbolMatch || nameMatch;
                }

                if (bestMatch) {
                    results.push({
                        asset,
                        score: bestMatch.score,
                        matches: bestMatch.matches
                    });
                }
            });

            results.sort((a, b) => b.score - a.score);
            return results.slice(0, 10);
        }

        function highlightMatches(text, matches) {
            if (!matches || matches.length === 0) {
                return text;
            }

            let result = '';
            for (let i = 0; i < text.length; i++) {
                if (matches.includes(i)) {
                    result += `<span class="match-highlight">${text[i]}</span>`;
                } else {
                    result += text[i];
                }
            }
            return result;
        }

        function renderAutocomplete(results) {
            const dropdown = document.getElementById('autocompleteDropdown');

            if (results.length === 0) {
                dropdown.innerHTML = '<div class="autocomplete-no-results">No assets found</div>';
                dropdown.classList.add('visible');
                return;
            }

            dropdown.innerHTML = results.map((result, index) => {
                const { asset } = result;
                const rateClass = asset.rate >= 0 ? 'positive' : 'negative';
                const rateSign = asset.rate >= 0 ? '+' : '';

                return `
                    <div class="autocomplete-item" data-index="${index}" data-symbol="${asset.symbol}">
                        <div class="autocomplete-symbol">
                            <span class="autocomplete-symbol-text">${asset.symbol}</span>
                            <span class="autocomplete-symbol-name">${asset.name}</span>
                        </div>
                        <div class="autocomplete-meta">
                            <span class="autocomplete-meta-item">${asset.exchanges} exchanges</span>
                            <span class="autocomplete-meta-item ${rateClass}">Rate: ${rateSign}${(asset.rate * 100).toFixed(3)}%</span>
                            <span class="autocomplete-meta-item ${rateClass}">APR: ${rateSign}${asset.apr.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            }).join('');

            dropdown.classList.add('visible');
            highlightedIndex = -1;
        }

        function hideAutocomplete() {
            const dropdown = document.getElementById('autocompleteDropdown');
            dropdown.classList.remove('visible');
            highlightedIndex = -1;
        }

        function addAssetTag(asset) {
            if (selectedAssets.some(a => a.symbol === asset.symbol)) {
                return;
            }

            selectedAssets.push(asset);
            renderAssetTags();
            updateActiveFilters();
            updateFilterCount();
        }

        function removeAssetTag(symbol) {
            selectedAssets = selectedAssets.filter(a => a.symbol !== symbol);
            renderAssetTags();
            updateActiveFilters();
            updateFilterCount();
        }

        function renderAssetTags() {
            const tagsContainer = document.getElementById('assetTags');
            tagsContainer.innerHTML = selectedAssets.map(asset => `
                <div class="asset-tag">
                    <span>${asset.symbol}</span>
                    <span class="tag-remove" data-symbol="${asset.symbol}">×</span>
                </div>
            `).join('');

            tagsContainer.querySelectorAll('.tag-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeAssetTag(btn.dataset.symbol);
                });
            });
        }

        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            activeFiltersContainer.innerHTML = '';

            const filters = [];

            if (selectedAssets.length > 0) {
                const assetNames = selectedAssets.map(a => a.symbol).join(', ');
                const displayText = selectedAssets.length === 1
                    ? assetNames
                    : `${selectedAssets.length} Assets: ${assetNames}`;
                filters.push({
                    type: 'assets',
                    text: displayText,
                    onRemove: () => {
                        selectedAssets = [];
                        renderAssetTags();
                        updateActiveFilters();
                        updateFilterCount();
                    }
                });
            }

            const selectedExchanges = Array.from(document.querySelectorAll('.exchange-item input[type="checkbox"]:checked'));
            if (selectedExchanges.length > 0 && selectedExchanges.length < 8) {
                const exchangeNames = selectedExchanges.map(cb => cb.closest('.exchange-item').querySelector('label').textContent).join(', ');
                const displayText = selectedExchanges.length === 1
                    ? exchangeNames
                    : `${selectedExchanges.length} Exchanges: ${exchangeNames}`;
                filters.push({
                    type: 'exchanges',
                    text: displayText,
                    onRemove: () => {
                        document.querySelectorAll('.exchange-item input[type="checkbox"]').forEach(cb => {
                            cb.checked = false;
                            cb.closest('.exchange-item').classList.remove('selected');
                        });
                        updateActiveFilters();
                        updateFilterCount();
                    }
                });
            }

            const selectedIntervals = Array.from(document.querySelectorAll('.interval-pill.selected'));
            if (selectedIntervals.length > 0 && selectedIntervals.length < 4) {
                const intervalTexts = selectedIntervals.map(pill => pill.textContent.trim()).join(', ');
                const displayText = selectedIntervals.length === 1
                    ? intervalTexts
                    : `${selectedIntervals.length} Intervals: ${intervalTexts}`;
                filters.push({
                    type: 'intervals',
                    text: displayText,
                    onRemove: () => {
                        document.querySelectorAll('.interval-pill').forEach(pill => {
                            pill.classList.remove('selected');
                        });
                        updateActiveFilters();
                        updateFilterCount();
                    }
                });
            }

            const minApr = document.getElementById('minApr');
            const maxApr = document.getElementById('maxApr');
            if ((minApr && minApr.selectedIndex > 0) || (maxApr && maxApr.selectedIndex < maxApr.options.length - 1)) {
                const minText = minApr.selectedIndex > 0 ? minApr.value : '';
                const maxText = maxApr.selectedIndex < maxApr.options.length - 1 ? maxApr.value : '';
                let displayText = 'APR: ';
                if (minText && maxText) {
                    displayText += `${minText} - ${maxText}`;
                } else if (minText) {
                    displayText += `> ${minText}`;
                } else {
                    displayText += `< ${maxText}`;
                }
                filters.push({
                    type: 'apr',
                    text: displayText,
                    onRemove: () => {
                        if (minApr) minApr.selectedIndex = 0;
                        if (maxApr) maxApr.selectedIndex = maxApr.options.length - 1;
                        updateActiveFilters();
                        updateFilterCount();
                    }
                });
            }

            const minOiEither = document.getElementById('minOiEither');
            const minOiCombined = document.getElementById('minOiCombined');
            if ((minOiEither && minOiEither.selectedIndex > 0) || (minOiCombined && minOiCombined.selectedIndex > 0)) {
                const parts = [];
                if (minOiEither && minOiEither.selectedIndex > 0) {
                    parts.push(`Min OI: ${minOiEither.value}`);
                }
                if (minOiCombined && minOiCombined.selectedIndex > 0) {
                    parts.push(`Combined: ${minOiCombined.value}`);
                }
                const displayText = parts.join(', ');
                filters.push({
                    type: 'liquidity',
                    text: displayText,
                    onRemove: () => {
                        if (minOiEither) minOiEither.selectedIndex = 0;
                        if (minOiCombined) minOiCombined.selectedIndex = 0;
                        updateActiveFilters();
                        updateFilterCount();
                    }
                });
            }

            filters.forEach(filter => {
                const filterTag = document.createElement('div');
                filterTag.className = 'filter-tag';
                filterTag.setAttribute('data-filter', filter.type);
                filterTag.innerHTML = `
                    ${filter.text}
                    <span class="remove">×</span>
                `;

                const removeBtn = filterTag.querySelector('.remove');
                removeBtn.addEventListener('click', filter.onRemove);

                activeFiltersContainer.appendChild(filterTag);
            });

            if (filters.length === 0) {
                activeFiltersContainer.innerHTML = '<span class="no-filters">No filters applied</span>';
            }
        }

        // Asset autocomplete initialization
        const assetSearchInput = document.getElementById('assetSearchInput');
        const assetTagInput = document.getElementById('assetTagInput');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');

        assetSearchInput.addEventListener('input', (e) => {
            const query = e.target.value;
            const results = searchAssets(query);
            renderAutocomplete(results);
        });

        assetSearchInput.addEventListener('keydown', (e) => {
            const dropdown = document.getElementById('autocompleteDropdown');
            const items = dropdown.querySelectorAll('.autocomplete-item');

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                highlightedIndex = Math.min(highlightedIndex + 1, items.length - 1);
                updateHighlight(items);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                highlightedIndex = Math.max(highlightedIndex - 1, -1);
                updateHighlight(items);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (highlightedIndex >= 0 && items[highlightedIndex]) {
                    const symbol = items[highlightedIndex].dataset.symbol;
                    const asset = SAMPLE_ASSETS.find(a => a.symbol === symbol);
                    if (asset) {
                        addAssetTag(asset);
                        assetSearchInput.value = '';
                        const results = searchAssets('');
                        renderAutocomplete(results);
                    }
                }
            } else if (e.key === 'Escape') {
                hideAutocomplete();
            } else if (e.key === 'Backspace' && assetSearchInput.value === '' && selectedAssets.length > 0) {
                removeAssetTag(selectedAssets[selectedAssets.length - 1].symbol);
            }
        });

        function updateHighlight(items) {
            items.forEach((item, index) => {
                if (index === highlightedIndex) {
                    item.classList.add('highlighted');
                    item.scrollIntoView({ block: 'nearest' });
                } else {
                    item.classList.remove('highlighted');
                }
            });
        }

        autocompleteDropdown.addEventListener('click', (e) => {
            e.stopPropagation();
            const item = e.target.closest('.autocomplete-item');
            if (item) {
                const symbol = item.dataset.symbol;
                const asset = SAMPLE_ASSETS.find(a => a.symbol === symbol);
                if (asset) {
                    addAssetTag(asset);
                    assetSearchInput.value = '';
                    assetSearchInput.focus();
                    const results = searchAssets('');
                    renderAutocomplete(results);
                }
            }
        });

        assetTagInput.addEventListener('click', () => {
            assetSearchInput.focus();
        });

        document.addEventListener('click', (e) => {
            if (!assetTagInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
                hideAutocomplete();
            }
        });

        // Exchange item interactions
        document.querySelectorAll('.exchange-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                }
                this.classList.toggle('selected', this.querySelector('input[type="checkbox"]').checked);
                updateFilterCount();
                updateActiveFilters();
            });
        });

        // Interval pill interactions
        document.querySelectorAll('.interval-pill').forEach(pill => {
            pill.addEventListener('click', function() {
                this.classList.toggle('selected');
                updateFilterCount();
                updateActiveFilters();
            });
        });

        // Filter tag removal
        document.querySelectorAll('.filter-tag .remove').forEach(remove => {
            remove.addEventListener('click', function() {
                this.parentElement.style.opacity = '0';
                setTimeout(() => {
                    this.parentElement.remove();
                }, 150);
            });
        });

        // Select field change listeners
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', () => {
                updateFilterCount();
                updateActiveFilters();
            });
        });

        // Initialize filter count and active filters on page load
        updateFilterCount();
        updateActiveFilters();
    </script>
</body>
</html>